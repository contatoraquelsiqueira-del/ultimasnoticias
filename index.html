<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AtualizaÃ§Ãµes - STF</title>

  <style>
    :root{
      --bg:#0b0c10;
      --card:#12141b;
      --txt:#e9eefc;
      --muted:#a6adbb;
      --line:#222635;
      --brand:#1f6feb;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:var(--txt);
    }
    header{
      position:sticky;
      top:0;
      background:rgba(11,12,16,.95);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--line);
      z-index:10;
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:16px; }
    h1{ margin:0 0 6px 0; font-size:18px; }
    .subhead{ margin:0; font-size:12px; color:var(--muted); line-height:1.4; }

    button{
      border:1px solid var(--line);
      background:var(--card);
      color:var(--txt);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      cursor:pointer;
    }
    button.primary{ background:var(--brand); border-color:var(--brand); }
    button:disabled{ opacity:.6; cursor:not-allowed; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center; }
    .status{ margin-top:10px; font-size:12px; color:var(--muted); }

    .grid{ display:grid; gap:12px; padding:16px; }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid var(--line);
      color:var(--muted);
      margin-bottom:10px;
    }
    .title{ margin:0; font-size:16px; font-weight:700; line-height:1.3; }
    .title a{ color:var(--txt); text-decoration:none; }
    .title a:hover{ text-decoration:underline; }

    .date{ margin-top:6px; font-size:12px; color:var(--muted); }

    /* âœ… LINKS CORRIGIDOS */
    .link{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      overflow-wrap:anywhere;
      word-break:normal;
      line-height:1.35;
    }
    .link a{
      color:var(--muted);
      text-decoration:none;
    }
    .link a:hover{
      text-decoration:underline;
    }

    .actions{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }

    .controlsBottom{
      padding:0 16px 24px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    footer{ padding:0 16px 24px; font-size:12px; color:var(--muted); }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <h1>AtualizaÃ§Ã£o automÃ¡tica â€” Assunto: STF</h1>
    <p class="subhead">
      App: Ãºltimas 24h. Resumo WhatsApp: Ãºltimas 12h. Ordenado do mais novo para o mais antigo.
    </p>

    <div class="row">
      <button id="refreshBtn" class="primary">Atualizar agora</button>
      <button id="summaryBtn">Gerar resumo (WhatsApp)</button>
      <button id="dailyBtn">ðŸ“° NotÃ­cias do dia â€” STF (copiar)</button>
    </div>

    <div class="status" id="status">Pronta para atualizar.</div>
  </div>
</header>

<main class="wrap">
  <div class="grid" id="list"></div>

  <div class="controlsBottom">
    <button id="loadMoreBtn">Carregar mais</button>
    <span class="status" id="countInfo"></span>
  </div>
</main>

<footer class="wrap">
  Este site Ã© um agregador de links de notÃ­cias pÃºblicas. Todo o conteÃºdo pertence aos veÃ­culos originais.
</footer>

<script>
/* ================= CONFIG ================= */
const DISPLAY_WINDOW_HOURS = 24;
const SUMMARY_WINDOW_HOURS = 12;
const INITIAL_SHOW = 50;
const LOAD_MORE_STEP = 30;
const SUMMARY_MAX = 20;

/* ================= FONTES (RSS) ================= */
const FEEDS = [
  { name:"UOL", url:"https://rss.uol.com.br/feed/noticias.xml" },
  { name:"Folha de S.Paulo", url:"https://feeds.folha.uol.com.br/emcimadahora/rss091.xml" },
  { name:"EstadÃ£o", url:"https://www.estadao.com.br/rss/ultimas.xml" },
  { name:"O Globo", url:"https://oglobo.globo.com/rss/oglobo.xml" },
  { name:"Valor EconÃ´mico", url:"https://valor.globo.com/rss/valor.xml" },

  { name:"Folha (Google News)", url:"https://news.google.com/rss/search?q=site:folha.uol.com.br%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419" },
  { name:"EstadÃ£o (Google News)", url:"https://news.google.com/rss/search?q=site:estadao.com.br%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419" },
  { name:"O Globo (Google News)", url:"https://news.google.com/rss/search?q=site:oglobo.globo.com%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419" },
  { name:"Valor (Google News)", url:"https://news.google.com/rss/search?q=site:valor.globo.com%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419" },

  { name:"AgÃªncia Brasil", url:"https://agenciabrasil.ebc.com.br/rss/ultimasnoticias/feed.xml" },
  { name:"CNN Brasil", url:"https://www.cnnbrasil.com.br/feed/" },
  { name:"BBC Brasil", url:"https://feeds.bbci.co.uk/portuguese/rss.xml" },
  { name:"G1", url:"https://g1.globo.com/rss/g1/" },
  { name:"MetrÃ³poles", url:"https://www.metropoles.com/feed" },
  { name:"Correio Braziliense", url:"https://www.correiobraziliense.com.br/rss/ultimas.xml" },
  { name:"CartaCapital", url:"https://www.cartacapital.com.br/feed/" },
  { name:"Veja", url:"https://veja.abril.com.br/feed/" },
  { name:"IstoÃ‰", url:"https://istoe.com.br/feed/" },
  { name:"R7", url:"https://noticias.r7.com/rss.xml" },
  { name:"JOTA", url:"https://www.jota.info/feed" },
  { name:"Migalhas", url:"https://www.migalhas.com.br/rss" },
  { name:"DW Brasil", url:"https://rss.dw.com/rdf/rss-pt-br" },
  { name:"Poder360", url:"https://www.poder360.com.br/feed/" },
  { name:"Congresso em Foco", url:"https://congressoemfoco.uol.com.br/feed/" },
  { name:"O Tempo", url:"https://www.otempo.com.br/rss/ultimas" },
  { name:"ConJur", url:"https://www.conjur.com.br/rss.xml" },
  { name:"PlatÃ´BR", url:"https://platobr.com.br/feed/" },
  { name:"ICL NotÃ­cias", url:"https://iclnoticias.com.br/feed/" },
  { name:"Revista Oeste", url:"https://revistaoeste.com/feed/" },
  { name:"O Antagonista", url:"https://oantagonista.com.br/feed/" },
  { name:"CrusoÃ©", url:"https://revistacrusoe.com.br/feed/" }
];

/* ================= PALAVRAS-CHAVE ================= */
const KEYWORDS = [
  "stf","supremo tribunal federal","supremo",
  "edson fachin","alexandre de moraes","gilmar mendes",
  "cÃ¡rmen lÃºcia","dias toffoli","luiz fux",
  "flÃ¡vio dino","cristiano zanin",
  "andrÃ© mendonÃ§a","nunes marques"
];

/* ================= UTIL ================= */
const RSS2JSON = url =>
  `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;

const els = {
  refresh: refreshBtn,
  summary: summaryBtn,
  daily: dailyBtn,
  loadMore: loadMoreBtn,
  list,
  status,
  countInfo
};

const normalize = t =>
  (t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");

const matchesTopic = i =>
  KEYWORDS.some(k => normalize((i.title||"")+i.description).includes(normalize(k)));

function parseFeedDate(d){ const x=new Date(d); return isNaN(x)?null:x; }
const formatDateTimeBR = d => new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(d);

/* ================= RENDER ================= */
let allTopic=[], appFiltered=[], shownCount=0;

function render(reset=false){
  if(reset) list.innerHTML="";
  appFiltered.slice(reset?0:shownCount-LOAD_MORE_STEP, shownCount).forEach(n=>{
    const wa=`https://wa.me/?text=${encodeURIComponent(n.title+"\n"+n.link)}`;
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class="pill">${n.source}</div>
      <h2 class="title"><a href="${n.link}" target="_blank">${n.title}</a></h2>
      <div class="date">ðŸ•’ ${formatDateTimeBR(n.date)}</div>
      <div class="link"><a href="${n.link}" target="_blank">${n.link}</a></div>
      <div class="actions">
        <a href="${wa}" target="_blank"><button>WhatsApp</button></a>
        <button onclick="navigator.clipboard.writeText('${n.title}\\n${n.link}')">ðŸ“‹ Copiar</button>
      </div>`;
    list.appendChild(c);
  });
  countInfo.textContent=`Mostrando ${shownCount} de ${appFiltered.length}`;
  loadMore.style.display=shownCount<appFiltered.length?"inline-block":"none";
}

/* ================= FETCH ================= */
async function run(){
  status.textContent="Atualizandoâ€¦";
  let all=[];
  const res=await Promise.allSettled(FEEDS.map(f=>fetch(RSS2JSON(f.url)).then(r=>r.json())));
  res.forEach((r,i)=>{
    if(r.status==="fulfilled"){
      r.value.items.forEach(it=>{
        const d=parseFeedDate(it.pubDate||it.isoDate);
        if(d) all.push({title:it.title,link:it.link,description:it.description,source:FEEDS[i].name,date:d});
      });
    }
  });
  all=all.filter(matchesTopic).sort((a,b)=>b.date-a.date);
  allTopic=all;
  const cutoff=Date.now()-24*3600000;
  appFiltered=all.filter(n=>n.date.getTime()>=cutoff);
  shownCount=Math.min(INITIAL_SHOW,appFiltered.length);
  render(true);
  status.textContent=`Atualizado â€¢ ${appFiltered.length} notÃ­cia(s)`;
}

refreshBtn.onclick=run;
loadMoreBtn.onclick=()=>{shownCount=Math.min(shownCount+LOAD_MORE_STEP,appFiltered.length);render();};

run();
</script>

</body>
</html>
